{% if settings.fx_scroll == true %}
  <script src="https://unpkg.com/scrollreveal"></script>
  <style>
    html.sr [data-reveal],
    html.sr  [data-reveal-fade] {

      visibility: hidden;
    }

    @media (min-width: 750px) {
      html.sr [data-reveal-desktop] {
          visibility: hidden;
      }
    }
  </style>
  <script>
    function generalReveal() {
      if (window.scrollStarted == true) {
        return ScrollReveal().sync();
      }
      window.scrollStarted = true;
      ScrollReveal().reveal('[data-reveal]', { duration: 400, distance: '40px', interval: 30, cleanup: true });
      ScrollReveal().reveal('[data-reveal-fade]', { duration: 600, distance: '0px', interval: 0, cleanup: true });
      ScrollReveal().reveal('[data-reveal-desktop]', { mobile: false, duration: 500, distance: '50px', interval: 25, cleanup: true });

    }
    window.addEventListener('DOMContentLoaded', function() {
      generalReveal();
    });

    window.addEventListener('RevealReset', function() {
      window.scrollStarted = false;
      ScrollReveal().clean('[data-reveal]');
      ScrollReveal().clean('[data-reveal-fade]');
      ScrollReveal().clean('[data-reveal-desktop]');
      ScrollReveal().destroy();
      console.log("Destroying scrollReveal")
      generalReveal()
    });
    window.addEventListener('RevealSync', function() {
      generalReveal()
    });
    document.addEventListener("shopify:section:load", function() {
      generalReveal();
    });



  </script>

  <script>


  </script>
{% endif %}


<!-- Any polyfill to enable smoothscroll for the JavaScript APIs -->
<script src="https://unpkg.com/smoothscroll-polyfill/dist/smoothscroll.min.js"></script>

<!-- This package, to apply the smoothscroll to anchor links -->
<script src="https://unpkg.com/smoothscroll-anchor-polyfill"></script>


<style>
  html {
    /* Normal CSS property for browsers with native support */
    scroll-behavior: smooth;

    /* Defined as the name of a font, so the polyfill can read it */
    font-family: "scroll-behavior: smooth", sans-serif;
  }
{% if settings.fx_underline_menu == true %}
  .list-menu__item, a.header__menu-item.list-menu__item {
    position: relative;
    overflow-x: hidden;
    transition: all 200ms ease;
  }

  .list-menu__item::after {
    position: absolute;
    bottom: 0;
    content:'';
    width: calc(100% - 4px);
    height: 1px;
    left: 2px;
    transform: translateX(-110%) scaleY(0.5);
    background: currentColor;
    transition: transform 200ms ease;
  }


  .list-menu__item--active {
    font-weight: bold
  }

  .list-menu__item:hover::after {
    transform: translateX(0%) scaleY(0.5);
  }

  .list-menu__item::after{
    transform: translateX(-110%) scaleY(0.5)
  }
  .list-menu__item:hover {
    transform: translateY(-2px);
  }

  .header__active-menu-item:hover::after{
    transform: translateX(0%) scaleY(1)
  }

{% endif %}
{% if settings.fx_underline_all == true %}
.article-content:hover .article-card__title {
  text-decoration: underline;
  text-underline-offset: 0.3rem;
}

  .card-wrapper:hover .card-information__text {
    text-decoration: underline;
    text-underline-offset: 0.3rem;
  }
.card-wrapper:hover .card__heading {
    text-decoration: underline;
    text-underline-offset: 0.3rem;
  }
  .cart-item__name:hover {
    text-decoration: underline;
    text-underline-offset: 0.3rem;
    text-decoration-thickness: 0.2rem;
  }
{% endif %}

</style>

  {% unless content_for_header contains "Shopify.designMode" %}
    {% if settings.enable_loading_effect == true  %}
    <script async src="https://unpkg.com/@barba/core"></script>
    <script async src="https://unpkg.com/@barba/prefetch"></script>
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.8.0/gsap.min.js"></script>
    <script>
      function barbaCheck() {
      if (typeof barba == 'object' ) {

        doBarba();

        return true;
      } return false;}
      function doBarba() {
        if (typeof barbaPrefetch != 'undefined') {
          barba.use(barbaPrefetch)
        }
        barba.init({
          cacheIgnore: ['/cart'],
          transitions: [{
            name : "default-transition",
            leave(data) {
              document.body.classList.add('loading');
              return gsap.to(data.current.container, {
                opacity: 0,
                scale: 1.05,
                y: 10,
                onComplete: function() { data.current.container.style.display = "none";}
              });

            },
            once() {
              document.body.classList.remove('loading');
               const url = new URL(window.location.href);
              const hash = url.hash;

              if (!hash || hash == '') {
                window.scrollTo({ top: 0, left: 0, behavior: 'smooth'});
              } else {
                const target = document.getElementById(hash.replace('#', ''));
                console.log(target);
                if (target) {
                  target.scrollIntoView({block: 'start', behavior:'smooth'})
                }
              }
            },
            beforeEnter(data) {
              if (data.next.container) {
                const nextTemplate = data.next.container.getAttribute('data-template');
                const templateClass = new RegExp(/\btemplate-.+?\b/, 'g');
                if (document.body.className.match(templateClass) && nextTemplate) {
                  document.body.className = nextTemplate + ' ' + document.body.className.replace(templateClass, '');
                }
              }

               window.scrollTo({ top: 0, left: 0, behavior: 'smooth'});

              const nextEl = data.next.container;
              if (nextEl) {
                console.log("AutoGenerating scripts and links");

                const nextScripts = nextEl.querySelectorAll('script')

                nextScripts.forEach(nextScript=> {
                  const src = nextScript.src;
                  if (document.head.querySelector('script[src="' + src + '"]') == undefined) {

                    //Have to create a new script element in order for the browser to execute the code
                    const newScript = document.createElement('script');
                    newScript.src = src;
                    newScript.async = true; //Best for loading practices, even though it's already loaded the DOM
                    document.head.append(newScript);

                    nextScript.remove(); //Cleaning up;
                    console.log("Appending script to head: " + src);

                  } else {
                    console.log("Script already exists")
                  }
                })


                console.log(nextEl.querySelectorAll('link'));
              }

              return;
            },
            afterEnter(data) {
              window.dispatchEvent(new Event('checkOverlay'));

              window.dispatchEvent(new Event('resize'));
              return gsap.from(data.next.container, {
                  opacity: 0,
                  scale: 1.04,
                  y: 10,

                }
              )
            },

            enter(data) {
              const url = new URL(window.location.href);
              const hash = url.hash;
              if (hash && hash !== '' ) {

                const target = document.getElementById(hash.replace('#', ''));
                if (target) {
                  target.scrollIntoView({block: 'start', behavior:'smooth'})
                }
              }
              document.body.classList.remove('loading');
              return;
            },
            after(data) {

              window.dispatchEvent(new Event('RevealReset'));
              window.dispatchEvent(new Event('resize'));

              return;
            }
          }]
        })
      }
      function barbaLoader() {
        var barbaInterval =setInterval( function() {
          if (barbaCheck()){
            return window.clearInterval(barbaInterval);
          }}, 200);
          window.removeEventListener('DOMContentLoaded', barbaLoader)

      }

      window.addEventListener('DOMContentLoaded' , barbaLoader)
    </script>
    <div class="preloader" aria-hidden="true">
      {% if settings.preloader_image  != blank %}
      <img src="{{settings.preloader_image | img_url: '320x320' }}" alt="loading site">
      {% endif %}
    </div>
    <style>
      .preloader {
        position: fixed;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background: var(--gradient-base-accent-2);
        transform: scale(1.1);
        transition: transform 400ms ease, opacity 500ms ease;
        opacity: 0;
        pointer-events: none;
        z-index: 10000000000;
      }
    .loading .preloader {
      opacity: 1;
      transform: scale(1);
    }
    .preloader img {
      position: absolute;
      left: 50%;
      top: 50%;
      width: 150px;
      height: auto;
      max-width: 40%;
      transform: translate3d(-50%, -50%, 0);
      }
    </style>
  {% endif %}
  {% endunless %}